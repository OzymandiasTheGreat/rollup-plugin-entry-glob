{"version":3,"file":"index.esm.js","sources":["../src/index.js"],"sourcesContent":["import { createFilter } from 'rollup-pluginutils';\nimport matched from 'matched';\n\n\nconst name = 'entry-glob';\nconst entry = '\\0rollup-plugin-entry-glob:single-entry';\nconst suppressed = '\\0rollup-plugin-entry-glob:suppressed';\n\n\nconst sortArray = (arr) => {\n\tconst scriptOrder = ['js', 'mjs', 'jsx', 'es', 'es6', 'ts', 'tsx', 'json'].reverse();\n\tconst assetOrder = ['html', 'htm', 'php', 'css', 'scss', 'sass', 'less', 'png', 'jpg', 'jpeg', 'gif', 'svg'];\n\treturn arr.sort((a, b) => {\n\t\tconst aExt = a.split('.').pop();\n\t\tconst bExt = b.split('.').pop();\n\t\treturn (-scriptOrder.indexOf(aExt) + assetOrder.indexOf(aExt)) - (-scriptOrder.indexOf(bExt) + assetOrder.indexOf(bExt));\n\t});\n};\n\n\nexport default function entryGlob(options) {\n\tconst module = options.fileName\n\t\t? `\\0${options.fileName}`\n\t\t: entry;\n\tconst filter = options.include || options.exclude\n\t\t? createFilter(options.include, options.exclude)\n\t\t: createFilter('**/*');\n\tconst imports = [];\n\tconst chunked = [];\n\tconst exporter = (path) => `export * from ${JSON.stringify(path)};`;\n\tconst importer = (path) => `import ${JSON.stringify(path)};`;\n\toptions.exports = options.exports === undefined || options.exports === true\n\t\t? true\n\t\t: false;\n\n\treturn {\n\t\tname,\n\n\t\toptions(config) {\n\t\t\tconst ret = [module, suppressed];\n\t\t\tconst chunks = {};\n\t\t\tif (config.manualChunks) {\n\t\t\t\tfor (let [ chunk, patterns ] of Object.entries(config.manualChunks)) {\n\t\t\t\t\tchunks[chunk] = [];\n\t\t\t\t\tmatched.sync(patterns, { realpath: true })\n\t\t\t\t\t\t.forEach((path) => {\n\t\t\t\t\t\t\tchunks[chunk].push(path);\n\t\t\t\t\t\t\tchunked.push(path);\n\t\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (config.input && config.input !== module) {\n\t\t\t\tmatched.sync(config.input, { realpath: true })\n\t\t\t\t\t.forEach((path) => {\n\t\t\t\t\t\tif (!chunked.includes(path)) {\n\t\t\t\t\t\t\tif (filter(path)) imports.push(path);\n\t\t\t\t\t\t\tret.push(path);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t}\n\t\t\tconfig.manualChunks = chunks;\n\t\t\tconfig.input = sortArray(ret);\n\t\t},\n\n\t\tresolveId(id) {\n\t\t\tif (id === module) return module;\n\t\t\tif (id === suppressed) return suppressed;\n\t\t\treturn null;\n\t\t},\n\n\t\tasync load(id) {\n\t\t\tif (id === module) {\n\t\t\t\tif (!imports.length) return Promise.resolve('');\n\t\t\t\treturn Promise.resolve(options.exports\n\t\t\t\t\t? imports.map(exporter).join('\\n')\n\t\t\t\t\t: imports.map(importer).join('\\n'));\n\t\t\t} else if (id === suppressed) {\n\t\t\t\tif (!chunked.length) return Promise.resolve('');\n\t\t\t\treturn Promise.resolve(chunked.map(exporter).join('\\n'));\n\t\t\t}\n\t\t},\n\n\t\tasync generateBundle(config, bundle) {\n\t\t\tconst fileName = `${module.replace('\\0', '_')}.js`;\n\t\t\tbundle[fileName].fileName = `${module.replace('\\0', '')}.js`;\n\t\t\tif (!imports.length) delete bundle[fileName];\n\t\t\tdelete bundle[`${suppressed.replace('\\0', '_')}.js`];\n\t\t\tfor (let [name, chunk] of Object.entries(bundle)) {\n\t\t\t\tif (imports.includes(chunk.facadeModuleId)\n\t\t\t\t\t\t&& (chunk.code === '\\n' || chunk.code === '\\r\\n')\n\t\t\t\t\t\t&& chunk.isEntry) {\n\t\t\t\t\tdelete bundle[name];\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t};\n}\n"],"names":["const","name","entry","suppressed","sortArray","arr","scriptOrder","reverse","assetOrder","sort","a","b","aExt","split","pop","bExt","indexOf","options","module","fileName","filter","include","exclude","createFilter","imports","chunked","exporter","path","JSON","stringify","importer","exports","undefined","config","ret","chunks","manualChunks","let","ref","chunk","matched","sync","patterns","realpath","forEach","push","Object","entries","input","includes","resolveId","id","load","length","Promise","resolve","map","join","generateBundle","bundle","replace","facadeModuleId","code","isEntry"],"mappings":"yEAIAA,IAAMC,EAAO,aACPC,EAAQ,0CACRC,EAAa,wCAGbC,WAAaC,GAClBL,IAAMM,EAAc,CAAC,KAAM,MAAO,MAAO,KAAM,MAAO,KAAM,MAAO,QAAQC,UACrEC,EAAa,CAAC,OAAQ,MAAO,MAAO,MAAO,OAAQ,OAAQ,OAAQ,MAAO,MAAO,OAAQ,MAAO,OACtG,OAAOH,EAAII,cAAMC,EAAGC,GACnBX,IAAMY,EAAOF,EAAEG,MAAM,KAAKC,MACpBC,EAAOJ,EAAEE,MAAM,KAAKC,MAC1B,OAASR,EAAYU,QAAQJ,GAAQJ,EAAWQ,QAAQJ,KAAWN,EAAYU,QAAQD,GAAQP,EAAWQ,QAAQD,sBAKrG,SAAmBE,GACjCjB,IAAMkB,EAASD,EAAQE,cACfF,EAAgB,SACrBf,EACGkB,EAASH,EAAQI,SAAWJ,EAAQK,QACvCC,EAAaN,EAAQI,QAASJ,EAAQK,SACtCC,EAAa,QACVC,EAAU,GACVC,EAAU,GACVC,WAAYC,0BAA0BC,KAAKC,UAAUF,QACrDG,WAAYH,mBAAmBC,KAAKC,UAAUF,QAKpD,OAJAV,EAAQc,aAA8BC,IAApBf,EAAQc,UAA6C,IAApBd,EAAQc,QAIpD,MACN9B,EAEAgB,iBAAQgB,GACPjC,IAAMkC,EAAM,CAAChB,EAAQf,GACfgC,EAAS,GACf,GAAIF,EAAOG,aACV,qBAAKC,IAAIC,qBACRH,EAAOI,GAAS,GAChBC,EAAQC,KAAKC,EAAU,CAAEC,UAAU,IACjCC,iBAASjB,GACTQ,EAAOI,GAAOM,KAAKlB,GACnBF,EAAQoB,KAAKlB,YALgBmB,OAAOC,QAAQd,EAAOG,kCASnDH,EAAOe,OAASf,EAAOe,QAAU9B,GACpCsB,EAAQC,KAAKR,EAAOe,MAAO,CAAEL,UAAU,IACrCC,iBAASjB,GACJF,EAAQwB,SAAStB,KACjBP,EAAOO,IAAOH,EAAQqB,KAAKlB,GAC/BO,EAAIW,KAAKlB,MAIbM,EAAOG,aAAeD,EACtBF,EAAOe,MAAQ5C,EAAU8B,IAG1BgB,mBAAUC,GACT,OAAIA,IAAOjC,EAAeA,EACtBiC,IAAOhD,EAAmBA,EACvB,MAGRiD,oBAAWD,GACV,OAAIA,IAAOjC,EACLM,EAAQ6B,OACNC,QAAQC,QAAQtC,EAAQc,QAC5BP,EAAQgC,IAAI9B,GAAU+B,KAAK,MAC3BjC,EAAQgC,IAAI1B,GAAU2B,KAAK,OAHFH,QAAQC,QAAQ,IAIlCJ,IAAOhD,EACZsB,EAAQ4B,OACNC,QAAQC,QAAQ9B,EAAQ+B,IAAI9B,GAAU+B,KAAK,OADtBH,QAAQC,QAAQ,SADtC,GAMFG,8BAAezB,EAAQ0B,GAC5B3D,IAAMmB,EAAcD,EAAO0C,QAAQ,KAAM,WACzCD,EAAOxC,GAAUA,SAAcD,EAAO0C,QAAQ,KAAM,UAC/CpC,EAAQ6B,eAAeM,EAAOxC,UAC5BwC,EAAUxD,EAAWyD,QAAQ,KAAM,YAC1C,IAAK,UAAqBd,OAAOC,QAAQY,mBAAS,CAA7CtB,IAAIC,qBACJd,EAAQyB,SAASV,EAAMsB,kBACN,OAAftB,EAAMuB,MAAgC,SAAfvB,EAAMuB,OAC9BvB,EAAMwB,gBACHJ,EAAO1D"}